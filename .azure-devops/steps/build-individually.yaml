steps:
# Build packages in dependency order without using Lerna or npm workspaces
# Each package is built by calling npm run build directly in its directory

- pwsh: |
    $ErrorActionPreference = "Stop"
    $root = Get-Location
    
    Write-Host "==== Level 0: No internal dependencies ===="
    Write-Host "Building office-addin-prettier-config..."
    Write-Host "No build script found, skipping..."
    
    Write-Host "==== Level 1: Depends only on Level 0 ===="
    Write-Host "Building eslint-plugin-office-addins..."
    Set-Location "$root/packages/eslint-plugin-office-addins"
    npm run build
    
    Write-Host "Building office-addin-usage-data..."
    Set-Location "$root/packages/office-addin-usage-data"
    npm run build
    
    Write-Host "==== Level 2: Depends on Level 0-1 ===="
    Write-Host "Building office-addin-cli..."
    Set-Location "$root/packages/office-addin-cli"
    npm run build
    
    Write-Host "Building eslint-config-office-addins..."
    Set-Location "$root/packages/eslint-config-office-addins"
    npm run build
    
    Write-Host "Building office-addin-lint..."
    Set-Location "$root/packages/office-addin-lint"
    npm run build
    
    Write-Host "==== Level 3: Depends on Level 0-2 ===="
    Write-Host "Building office-addin-node-debugger..."
    Set-Location "$root/packages/office-addin-node-debugger"
    npm run build
    
    Write-Host "Building office-addin-manifest..."
    Set-Location "$root/packages/office-addin-manifest"
    npm run build
    
    Write-Host "Building custom-functions-metadata..."
    Set-Location "$root/packages/custom-functions-metadata"
    npm run build
    
    Write-Host "Building eslint-plugin-excel-custom-functions..."
    Set-Location "$root/packages/eslint-plugin-excel-custom-functions"
    npm run build
    
    Write-Host "==== Level 4: Depends on Level 0-3 ===="
    Write-Host "Building office-addin-dev-certs..."
    Set-Location "$root/packages/office-addin-dev-certs"
    npm run build
    
    Write-Host "Building office-addin-dev-settings..."
    Set-Location "$root/packages/office-addin-dev-settings"
    npm run build
    
    Write-Host "Building office-addin-mock..."
    Set-Location "$root/packages/office-addin-mock"
    npm run build
    
    Write-Host "Building office-addin-project..."
    Set-Location "$root/packages/office-addin-project"
    npm run build
    
    Write-Host "Building custom-functions-metadata-plugin..."
    Set-Location "$root/packages/custom-functions-metadata-plugin"
    npm run build
    
    Write-Host "==== Level 5: Depends on Level 0-4 ===="
    Write-Host "Building office-addin-test-server..."
    Set-Location "$root/packages/office-addin-test-server"
    npm run build
    
    Write-Host "Building office-addin-debugging..."
    Set-Location "$root/packages/office-addin-debugging"
    npm run build
    
    Write-Host "Building office-addin-sso..."
    Set-Location "$root/packages/office-addin-sso"
    npm run build
    
    Write-Host "==== Level 6: Depends on Level 0-5 ===="
    Write-Host "Building office-addin-test-helpers..."
    Set-Location "$root/packages/office-addin-test-helpers"
    npm run build
    
    Set-Location $root
  displayName: 'Build packages individually'
  continueOnError: false