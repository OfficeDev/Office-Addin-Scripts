steps:
- script: |
    echo Node and NPM versions:
    node -v
    npm -v
    echo.
    echo Current directory:
    cd
    echo.
    echo Check if lerna is installed:
    where lerna 2>nul || echo lerna not in PATH
    echo.
    echo Check node_modules\.bin:
    dir node_modules\.bin\lerna* 2>nul || echo No lerna in node_modules\.bin
    echo.
    echo Try npx lerna version:
    npx lerna -v
    echo Lerna version exit code: %ERRORLEVEL%
    echo.
    echo List installed packages:
    npm list --depth=0 2>nul || echo npm list failed
    echo.
    echo Try running lerna list:
    npx lerna list --no-ci
    echo Lerna list exit code: %ERRORLEVEL%
    echo.
    echo Try running lerna list with verbose:
    npx lerna list --no-ci --loglevel verbose
    echo.
    echo === Run build ===
    npx lerna run build --no-ci --stream --concurrency 1
    echo === Workaround: Use npm workspaces directly ===
    npm run build
  displayName: Build (script) with debugging
