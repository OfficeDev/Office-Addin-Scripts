# steps:
# - script: |
#     node -v
#     npm -v
#     npm ci
#     npm run build -- --stream --concurrency 1
#   displayName: Build (script)
#   env:
#     LERNA_DEBUG: "*"
#     NPM_CONFIG_LOGLEVEL: "verbose"

# steps:
# - script: |
#     npx lerna list
#     npx lerna run build --stream --concurrency 1
#   displayName: Build (script)

steps:
- script: |
    echo Node and NPM versions:
    node -v
    npm -v
    echo.
    echo Check if lerna is installed:
    where lerna
    echo.
    echo Check node_modules:
    dir * 2>nul || echo No lerna in 
    echo.
    echo Try npx lerna version:
    npx lerna -v
    echo Exit code: %ERRORLEVEL%
    echo.
    echo Check if lerna exists in package-lock:
    findstr /C:"\"lerna\"" 
    echo.
    echo List installed packages:
    npm list --depth=0
    echo.
    echo Try running lerna directly from node_modules:
    node  -v
    echo.
    echo === Workaround: Use npm workspaces directly ===
    npm run build
    if errorlevel 1 (
        echo npm list failed with exit code %ERRORLEVEL%
        exit /b 0
    )
  displayName: Build (script) with debugging