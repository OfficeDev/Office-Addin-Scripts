# steps:
# - script: |
#     node -v
#     npm -v
#     npm ci
#     npm run build -- --stream --concurrency 1
#   displayName: Build (script)
#   env:
#     LERNA_DEBUG: "*"
#     NPM_CONFIG_LOGLEVEL: "verbose"

# steps:
# - script: |
#     npx lerna list
#     npx lerna run build --stream --concurrency 1
#   displayName: Build (script)

steps:
- script: |
    echo Current directory:
    cd
    echo.
    echo Test glob pattern manually:
    for /d %%d in (packages\*) do @echo Package dir: %%d
    echo.
    echo Check if package.json files are readable:
    for /d %%d in (packages\*) do @(
      if exist %%d\package.json (
        echo Found package.json in %%d
        type %%d\package.json | findstr /C:"\"name\"" /C:"\"build\""
      ) else (
        echo NO package.json in %%d
      )
    )
    echo.
    echo Try reading one package.json directly:
    type packages\office-addin-cli\package.json
    echo.
    echo Check file attributes:
    attrib packages\office-addin-cli\package.json
    echo.
    echo Lerna list with full debug:
    set LERNA_PACKAGE_LOG_LEVEL=silly
    echo.
    echo Run build with --no-ci flag:
    npx lerna run build --stream --concurrency 1 --no-ci
  displayName: Build (script) with debugging